<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports Management - Sprint Reports System</title>
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="preload" as="style" onload="this.rel='stylesheet'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Main styles -->
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/unified-nav.css">

    <!-- Theme manager (loads early) -->
    <script src="/static/theme-manager.js"></script>

    <!-- External libraries (defer non-critical) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>

    <!-- Load non-critical CSS asynchronously -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"></noscript>
</head>
<body>
    <!-- Navigation Header -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="nav-brand"><i class="fas fa-rocket"></i> Sprint Reports System</div>
            <div style="display: flex; align-items: center;">
                <div class="nav-links">
                    <a href="/dashboard" class="nav-link"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                    <a href="/reports" class="nav-link active"><i class="fas fa-chart-line"></i> Reports</a>
                    <a href="/create-report" class="nav-link"><i class="fas fa-plus-circle"></i> New Report</a>
                    <a href="/manage" class="nav-link"><i class="fas fa-cogs"></i> Manage Data</a>
                    <a href="/project-statistics" class="nav-link"><i class="fas fa-chart-pie"></i> Project Statistics</a>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-sun" id="theme-icon"></i>
                    <span id="theme-text">Light</span>
                </button>
            </div>
        </div>
    </nav>

    <div class="main-wrapper">
        <!-- Reports List Page -->
        <div id="reportsPage" class="page active">
            <div class="reports-container">
            <div class="dashboard-header">
                <h1><i class="fas fa-chart-line"></i> Reports Management</h1>
                <p>Search, filter, and manage your quality assurance reports</p>
            </div>

            <!-- New Report Section -->
            <div class="new-report-section">
                <div class="new-report-content">
                    <div class="new-report-info">
                        <div class="section-header">
                            <h2><i class="fas fa-plus-circle"></i> Create New Report</h2>
                            <p>Start building your comprehensive QA testing report with our guided form</p>
                        </div>
                        <div class="report-features">
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>9-step guided process</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-chart-bar"></i>
                                <span>Auto-calculated metrics</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-file-export"></i>
                                <span>Export to PDF/Excel</span>
                            </div>
                        </div>
                        <div class="new-report-actions">
                            <button class="primary-create-btn" onclick="window.location.href='/create-report'">
                                <i class="fas fa-plus-circle"></i> 
                                <span>Create New Report</span>
                            </button>
                        </div>
                    </div>
                    <div class="new-report-preview">
                        <div class="preview-header">
                            <h3><i class="fas fa-eye"></i> Report Preview</h3>
                        </div>
                        <div class="preview-mockup">
                            <div class="mockup-header">
                                <div class="mockup-title">Sprint 24 - QA Report</div>
                                <div class="mockup-meta">Project Alpha â€¢ Jan 2025</div>
                            </div>
                            <div class="mockup-sections">
                                <div class="mockup-section">
                                    <div class="section-icon"><i class="fas fa-info-circle"></i></div>
                                    <div class="section-name">General Details</div>
                                </div>
                                <div class="mockup-section">
                                    <div class="section-icon"><i class="fas fa-chart-bar"></i></div>
                                    <div class="section-name">Test Summary</div>
                                </div>
                                <div class="mockup-section">
                                    <div class="section-icon"><i class="fas fa-user-check"></i></div>
                                    <div class="section-name">User Stories</div>
                                </div>
                                <div class="mockup-section">
                                    <div class="section-icon"><i class="fas fa-vial"></i></div>
                                    <div class="section-name">Test Cases</div>
                                </div>
                                <div class="mockup-section more-sections">
                                    <div class="section-icon"><i class="fas fa-ellipsis-h"></i></div>
                                    <div class="section-name">+5 more sections</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Filters Section -->
            <div class="filters-section">
                <div class="filters-header">
                    <h2><i class="fas fa-filter"></i> Search & Filters</h2>
                    <div class="filters-actions">
                        <button class="filter-btn" onclick="showAllReports()"><i class="fas fa-list"></i> Show All</button>
                        <button class="filter-btn" onclick="refreshFilterData()"><i class="fas fa-sync"></i> Refresh Data</button>
                        <button class="filter-btn" onclick="clearAllFilters()"><i class="fas fa-times"></i> Clear All</button>
                        <button class="filter-btn toggle-filters" onclick="toggleFiltersVisibility()"><i class="fas fa-eye-slash"></i> <span id="toggleText">Show Filters</span></button>
                    </div>
                </div>
                
                <div class="filters-container hidden" id="filtersContainer">
                    <!-- Search Row -->
                    <div class="filter-row">
                        <div class="filter-group full-width">
                            <label for="searchInput"><i class="fas fa-search"></i> Search Reports</label>
                            <div class="search-input-container">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="filter-input search-input" placeholder="Search by report title, project, or portfolio..." id="searchInput" onkeyup="searchReports()">
                                <button class="search-btn" onclick="searchReports()"><i class="fas fa-search"></i> Search</button>
                            </div>
                        </div>
                    </div>

                    <!-- Filter Controls Row 1 -->
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="projectFilter"><i class="fas fa-project-diagram"></i> Project</label>
                            <select id="projectFilter" class="filter-select" onchange="applyFilters()">
                                <option value="">All Projects</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="portfolioFilter"><i class="fas fa-briefcase"></i> Portfolio</label>
                            <select id="portfolioFilter" class="filter-select" onchange="applyFilters()">
                                <option value="">All Portfolios</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="testerFilter"><i class="fas fa-user-check"></i> Tester</label>
                            <select id="testerFilter" class="filter-select" onchange="applyFilters()">
                                <option value="">All Testers</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="statusFilter"><i class="fas fa-flag"></i> Status</label>
                            <select id="statusFilter" class="filter-select" onchange="applyFilters()">
                                <option value="">All Statuses</option>
                                <option value="passed">Passed</option>
                                <option value="passed-with-issues">Passed with Issues</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="cancelled">Cancelled</option>
                                <option value="deferred">Deferred</option>
                                <option value="not-testable">Not Testable</option>
                            </select>
                        </div>
                    </div>

                    <!-- Filter Controls Row 2 - Date Ranges -->
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="dateFromFilter"><i class="fas fa-calendar-alt"></i> Date From</label>
                            <input type="date" id="dateFromFilter" class="filter-input date-input" onchange="applyFilters()">
                        </div>
                        
                        <div class="filter-group">
                            <label for="dateToFilter"><i class="fas fa-calendar-alt"></i> Date To</label>
                            <input type="date" id="dateToFilter" class="filter-input date-input" onchange="applyFilters()">
                        </div>
                        
                        <div class="filter-group">
                            <label for="sprintFilter"><i class="fas fa-running"></i> Sprint Number</label>
                            <input type="number" id="sprintFilter" class="filter-input" placeholder="Sprint #" min="1" onchange="applyFilters()">
                        </div>
                        
                        <div class="filter-group">
                            <label for="sortFilter"><i class="fas fa-sort"></i> Sort By</label>
                            <select id="sortFilter" class="filter-select" onchange="applyFilters()">
                                <option value="date-desc">Date (Newest First)</option>
                                <option value="date-asc">Date (Oldest First)</option>
                                <option value="title-asc">Title (A-Z)</option>
                                <option value="title-desc">Title (Z-A)</option>
                                <option value="project-asc">Project (A-Z)</option>
                                <option value="sprint-desc">Sprint (Highest First)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Quick Filter Buttons -->
                    <div class="filter-row quick-filters">
                        <div class="filter-group full-width">
                            <label><i class="fas fa-bolt"></i> Quick Filters</label>
                            <div class="quick-filter-buttons">
                                <button class="quick-filter-btn" onclick="applyQuickFilter('today')"><i class="fas fa-calendar-day"></i> Today</button>
                                <button class="quick-filter-btn" onclick="applyQuickFilter('week')"><i class="fas fa-calendar-week"></i> This Week</button>
                                <button class="quick-filter-btn" onclick="applyQuickFilter('month')"><i class="fas fa-calendar-alt"></i> This Month</button>
                                <button class="quick-filter-btn" onclick="applyQuickFilter('failed')"><i class="fas fa-times-circle"></i> Failed Reports</button>
                                <button class="quick-filter-btn" onclick="applyQuickFilter('recent')"><i class="fas fa-clock"></i> Recent (7 days)</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter Results Summary -->
                <div class="filter-results-summary" id="filterResultsSummary">
                    <span class="results-count">Showing <strong id="resultsCount">0</strong> reports</span>
                    <div class="active-filters" id="activeFilters"></div>
                </div>
            </div>

            <div class="reports-table-container">
                <div id="reports-loading" class="loading-spinner-container" style="display: none;">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p>Loading reports...</p>
                    </div>
                </div>
                <table class="reports-table" id="reportsTable">
                    <thead>
                        <tr>
                            <th>Report Title</th>
                            <th>Project</th>
                            <th>Portfolio</th>
                            <th>Sprint</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="reportsTableBody">
                        <!-- Reports will be rendered here by script.js -->
                    </tbody>
                </table>

                <div class="pagination" id="pagination">
                    <!-- Pagination will be rendered here by script.js -->
                </div>
            </div>
        </div>
    </div>
    </div>


    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Link to the external JavaScript files -->
    <script src="/static/enhanced_script.js" defer></script>
    <script src="/static/Charts.js" defer></script>
    <script src="/test-filters.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize theme first
            if (window.themeManager) {
                window.themeManager.init();
            }
            
            // Set active class for navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                if (link.getAttribute('href') === window.location.pathname) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            
            // Initialize filter dropdowns and load data
            await initializeFilterDropdowns();
            
            // Initial data load with filters
            applyFilters();
        });
        
        function showReportsLoading() {
            document.getElementById('reports-loading').style.display = 'flex';
            document.getElementById('reportsTable').style.display = 'none';
        }
        
        function hideReportsLoading() {
            document.getElementById('reports-loading').style.display = 'none';
            document.getElementById('reportsTable').style.display = 'table';
        }


    </script>
</body>
</html>
