<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>User Management - QA Reports System</title>

        <!-- Preload critical resources -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />

        <!-- Main styles -->
        <link rel="stylesheet" href="/static/style.css" />
        <link rel="stylesheet" href="/static/unified-nav.css" />
        <link rel="stylesheet" href="/static/css/user_management_styles.css" />
        <!-- Theme manager -->
        <script src="/static/theme-manager.js"></script>

        <!-- Navigation script -->
        <script src="/static/nav.js" defer></script>

    </head>

    <body>
        <!-- Navigation Header -->
        <nav class="main-nav">
            <div class="nav-container">
                <div class="nav-brand">
                    <i class="fas fa-rocket"></i> QA Reports System
                </div>

                <button class="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>

                <div class="nav-links">
                    <a href="/dashboard" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                    <a href="/reports" class="nav-link">
                        <i class="fas fa-chart-line"></i>
                        <span class="nav-text">Reports</span>
                    </a>
                    <a href="/report-types" class="nav-link">
                        <i class="fas fa-plus-circle"></i>
                        <span class="nav-text">New Report</span>
                    </a>
                    <a href="/manage" class="nav-link">
                        <i class="fas fa-cogs"></i>
                        <span class="nav-text">Manage Data</span>
                    </a>
                    <a href="/project-statistics" class="nav-link">
                        <i class="fas fa-chart-pie"></i>
                        <span class="nav-text">Statistics</span>
                    </a>
                </div>

                <div class="nav-controls">
                    <div class="nav-user">
                        <div class="nav-dropdown">
                            <button class="nav-dropdown-btn">
                                <i class="fas fa-user-circle"></i>
                                <span class="user-name" id="navUserName"
                                    >User</span
                                >
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="nav-dropdown-content">
                                <a href="/profile">
                                    <i class="fas fa-user"></i>
                                    Profile
                                </a>
                                <a href="/user-management" class="admin-only">
                                    <i class="fas fa-users-cog"></i>
                                    User Management
                                </a>
                                <a href="/logout">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Logout
                                </a>
                            </div>
                        </div>
                    </div>

                    <button class="theme-toggle" onclick="toggleTheme()">
                        <i class="fas fa-sun" id="theme-icon"></i>
                        <span id="theme-text">Light</span>
                    </button>
                </div>
            </div>
        </nav>

        <div class="main-wrapper">
            <div class="reports-container">
                <div class="dashboard-header">
                    <h1><i class="fas fa-users-cog"></i> User Management</h1>
                    <p>
                        Manage user accounts, permissions, and password reset
                        requests
                    </p>
                </div>

                <div class="management-tabs">
                    <button
                        class="management-tab active"
                        onclick="showTab('users')"
                    >
                        <i class="fas fa-users"></i> User Accounts
                    </button>
                    <button
                        class="management-tab"
                        onclick="showTab('reset-requests')"
                    >
                        <i class="fas fa-key"></i> Password Reset Requests
                    </button>
                    <button
                        class="management-tab"
                        onclick="showTab('email-settings')"
                    >
                        <i class="fas fa-envelope"></i> Email Settings
                    </button>
                </div>

                <!-- Users Tab -->
                <div id="users-tab" class="tab-content active">
                    <div class="dashboard-section">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="section-title">
                                    <i class="fas fa-users"></i> User Accounts
                                </h2>
                            </div>
                            <div class="card-body">
                                <div id="usersContainer">
                                    <div class="loading-spinner-container">
                                        <div class="loading-spinner"></div>
                                        <p>Loading users...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Password Reset Requests Tab -->
                <div id="reset-requests-tab" class="tab-content">
                    <div class="dashboard-section">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="section-title">
                                    <i class="fas fa-key"></i> Password Reset
                                    Requests
                                </h2>
                            </div>
                            <div class="card-body">
                                <div id="resetRequestsContainer">
                                    <div class="loading-spinner-container">
                                        <div class="loading-spinner"></div>
                                        <p>Loading reset requests...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Email Settings Tab -->
                <div id="email-settings-tab" class="tab-content">
                    <div class="dashboard-section">
                        <div class="email-settings-container">
                            <!-- Email Configuration Status -->
                            <div class="card">
                                <div class="card-header">
                                    <h3>
                                        <i class="fas fa-cog"></i> Configuration
                                        Status
                                    </h3>
                                </div>
                                <div class="card-body">
                                    <div id="emailConfigStatus">
                                        <div class="loading-spinner-container">
                                            <div class="loading-spinner"></div>
                                            <p>
                                                Checking email configuration...
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Test Email -->
                            <div class="card">
                                <div class="card-header">
                                    <h3>
                                        <i class="fas fa-paper-plane"></i> Send
                                        Test Email
                                    </h3>
                                </div>
                                <div class="card-body">
                                    <p>
                                        Send a test email to verify your email
                                        configuration is working correctly.
                                    </p>
                                    <div class="form-group">
                                        <label for="testEmailAddress"
                                            >Test Email Address:</label
                                        >
                                        <input
                                            type="email"
                                            id="testEmailAddress"
                                            class="form-control"
                                            placeholder="Enter email address"
                                        />
                                    </div>
                                    <button
                                        class="btn btn-primary"
                                        onclick="sendTestEmail()"
                                    >
                                        <i class="fas fa-paper-plane"></i> Send
                                        Test Email
                                    </button>
                                </div>
                            </div>

                            <!-- Email Configuration Guide -->
                            <div class="card">
                                <div class="card-header">
                                    <h3>
                                        <i class="fas fa-info-circle"></i>
                                        Configuration Guide
                                    </h3>
                                </div>
                                <div class="card-body">
                                    <p>
                                        To enable email notifications, set the
                                        following environment variables:
                                    </p>
                                    <div class="code-block">
                                        <pre><code># Gmail Configuration
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password
MAIL_DEFAULT_SENDER=your-email@gmail.com</code></pre>
                                    </div>
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle"></i>
                                        <strong>Gmail Setup:</strong> Enable
                                        2-factor authentication and generate an
                                        "App Password" for MAIL_PASSWORD.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast container -->
        <div class="toast-container" id="toastContainer"></div>

        <!-- User Details Modal -->
        <div id="userDetailsModal" class="modal" style="display: none">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-user"></i> User Details</h3>
                    <button
                        class="modal-close"
                        onclick="closeModal('userDetailsModal')"
                    >
                        &times;
                    </button>
                </div>
                <div class="modal-body" id="userDetailsContent">
                    <!-- User details will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Edit User Modal -->
        <div id="editUserModal" class="modal" style="display: none">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-edit"></i> Edit User</h3>
                    <button
                        class="modal-close"
                        onclick="closeModal('editUserModal')"
                    >
                        &times;
                    </button>
                </div>
                <div class="modal-body">
                    <form id="editUserForm">
                        <input type="hidden" id="editUserId" />

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editFirstName">First Name *</label>
                                <input
                                    type="text"
                                    id="editFirstName"
                                    class="form-control"
                                    required
                                />
                            </div>
                            <div class="form-group">
                                <label for="editLastName">Last Name *</label>
                                <input
                                    type="text"
                                    id="editLastName"
                                    class="form-control"
                                    required
                                />
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="editEmail">Email *</label>
                            <input
                                type="email"
                                id="editEmail"
                                class="form-control"
                                required
                            />
                        </div>

                        <div class="form-group">
                            <label for="editUsername">Username</label>
                            <input
                                type="text"
                                id="editUsername"
                                class="form-control"
                            />
                        </div>

                        <div class="form-group">
                            <label for="editPhoneNumber">Phone Number</label>
                            <input
                                type="tel"
                                id="editPhoneNumber"
                                class="form-control"
                                placeholder="05xxxxxxxx"
                            />
                        </div>

                        <div class="form-group">
                            <label>Permissions</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="editIsAdmin" />
                                    Administrator
                                </label>
                                <label class="checkbox-label">
                                    <input
                                        type="checkbox"
                                        id="editIsApproved"
                                    />
                                    Approved
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="editIsActive" />
                                    Active
                                </label>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button
                                type="button"
                                class="btn btn-secondary"
                                onclick="closeModal('editUserModal')"
                            >
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                Update User
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Change Password Modal -->
        <div id="changePasswordModal" class="modal" style="display: none">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-key"></i> Change Password</h3>
                    <button
                        class="modal-close"
                        onclick="closeModal('changePasswordModal')"
                    >
                        &times;
                    </button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <input type="hidden" id="passwordUserId" />

                        <div class="form-group">
                            <label for="newPassword">New Password *</label>
                            <input
                                type="password"
                                id="newPassword"
                                class="form-control"
                                required
                            />
                            <small class="form-text"
                                >Password must be at least 8 characters with
                                uppercase, lowercase, number, and special
                                character.</small
                            >
                        </div>

                        <div class="form-group">
                            <label for="confirmPassword"
                                >Confirm Password *</label
                            >
                            <input
                                type="password"
                                id="confirmPassword"
                                class="form-control"
                                required
                            />
                        </div>

                        <div class="form-actions">
                            <button
                                type="button"
                                class="btn btn-secondary"
                                onclick="closeModal('changePasswordModal')"
                            >
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                Update Password
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <script src="/static/js/user_management.js"></script>
    </body>
</html>
