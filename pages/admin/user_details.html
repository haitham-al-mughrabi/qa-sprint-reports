<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>User Details - QA Reports System</title>

        <!-- Preload critical resources -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />

        <!-- Main styles -->
        <link rel="stylesheet" href="/static/style.css" />
        <link rel="stylesheet" href="/static/unified-nav.css" />
        <link rel="stylesheet" href="/static/css/user_details_styles.css" />
        <!-- Theme manager -->
        <script src="/static/theme-manager.js"></script>

        <!-- Navigation script -->
        <script src="/static/nav.js" defer></script>


    </head>

    <body>
        <!-- Navigation Header -->
        <nav class="main-nav">
            <div class="nav-container">
                <div class="nav-brand">
                    <i class="fas fa-rocket"></i> QA Reports System
                </div>

                <button class="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>

                <div class="nav-links">
                    <a href="/dashboard" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                    <a href="/reports" class="nav-link">
                        <i class="fas fa-chart-line"></i>
                        <span class="nav-text">Reports</span>
                    </a>
                    <a href="/report-types" class="nav-link">
                        <i class="fas fa-plus-circle"></i>
                        <span class="nav-text">New Report</span>
                    </a>
                    <a href="/manage" class="nav-link">
                        <i class="fas fa-cogs"></i>
                        <span class="nav-text">Manage Data</span>
                    </a>
                    <a href="/project-statistics" class="nav-link">
                        <i class="fas fa-chart-pie"></i>
                        <span class="nav-text">Statistics</span>
                    </a>
                </div>

                <div class="nav-controls">
                    <div class="nav-user">
                        <div class="nav-dropdown">
                            <button class="nav-dropdown-btn">
                                <i class="fas fa-user-circle"></i>
                                <span class="user-name" id="navUserName"
                                    >User</span
                                >
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="nav-dropdown-content">
                                <a href="/profile">
                                    <i class="fas fa-user"></i>
                                    Profile
                                </a>
                                <a href="/user-management" class="admin-only">
                                    <i class="fas fa-users-cog"></i>
                                    User Management
                                </a>
                                <a href="/logout">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Logout
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <button class="theme-toggle" onclick="toggleTheme()">
                        <i class="fas fa-sun" id="theme-icon"></i>
                        <span id="theme-text">Light</span>
                    </button>
                </div>
            </div>
        </nav>

    <div class="main-wrapper">
        <div class="dashboard-container">
            <div class="dashboard-header">
                <h1><i class="fas fa-user-circle"></i> User Information</h1>
                <p>View and manage user account details</p>
            </div>

            <!-- Action Bar -->
            <div class="action-bar">
                <div class="action-left">
                    <a href="/user-management" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i>
                        Back to Users
                    </a>
                </div>
                <div class="action-right">
                    <button class="btn btn-secondary" onclick="refreshUserData()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                    <button class="btn btn-danger" onclick="showDeleteConfirmation()">
                        <i class="fas fa-trash"></i>
                        Delete User
                    </button>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingContainer" class="loading-container">
                <div class="loading-spinner"></div>
                <p>Loading user details...</p>
            </div>

            <!-- Error State -->
            <div id="errorContainer" class="empty-state" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Error Loading User</h3>
                <p id="errorMessage">Failed to load user details</p>
                <button class="btn btn-primary" onclick="refreshUserData()">
                    <i class="fas fa-retry"></i>
                    Try Again
                </button>
            </div>

            <!-- Main Content Layout -->
            <div id="mainContent" class="user-layout" style="display: none;">
                <!-- Profile Card -->
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar-container">
                            <div class="profile-avatar" id="userAvatar">
                                <span id="avatarInitials">U</span>
                            </div>
                            <div class="avatar-status" id="userStatus"></div>
                        </div>
                        <h2 class="profile-name" id="userName">Loading...</h2>
                        <p class="profile-email" id="userEmail">Loading...</p>
                        <div class="profile-badges" id="userBadges">
                            <!-- Badges will be populated dynamically -->
                        </div>
                    </div>

                    <div class="profile-stats">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="totalReports">0</div>
                                <div class="stat-label">Reports</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="loginCount">0</div>
                                <div class="stat-label">Logins</div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-item-label">
                                <i class="fas fa-calendar-plus"></i>
                                Member Since
                            </div>
                            <div class="stat-item-value" id="memberSince">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-item-label">
                                <i class="fas fa-clock"></i>
                                Last Login
                            </div>
                            <div class="stat-item-value" id="lastLogin">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-item-label">
                                <i class="fas fa-edit"></i>
                                Last Updated
                            </div>
                            <div class="stat-item-value" id="lastUpdated">-</div>
                        </div>
                    </div>
                </div>

                <!-- Content Area -->
                <div class="content-area">
                    <!-- Tabs Header -->
                    <div class="tabs-header">
                        <button class="tab-btn active" onclick="switchTab('view')">
                            <i class="fas fa-eye"></i>
                            View Information
                        </button>
                        <button class="tab-btn" onclick="switchTab('profile')">
                            <i class="fas fa-edit"></i>
                            Edit Profile
                        </button>
                        <button class="tab-btn" onclick="switchTab('password')">
                            <i class="fas fa-key"></i>
                            Change Password
                        </button>
                        <button class="tab-btn" onclick="switchTab('settings')">
                            <i class="fas fa-cog"></i>
                            Account Settings
                        </button>
                        <button class="tab-btn" onclick="switchTab('activity')">
                            <i class="fas fa-history"></i>
                            Activity Log
                        </button>
                    </div>

                    <!-- View Information Tab -->
                    <div id="viewTab" class="tab-content active">
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-user-circle"></i>
                                User Information Overview
                            </h3>
                            <div class="info-grid">
                                <div class="info-card">
                                    <div class="info-card-title">
                                        <i class="fas fa-id-card"></i>
                                        Personal Details
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Full Name</div>
                                        <div class="info-value" id="viewFullName">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">First Name</div>
                                        <div class="info-value" id="viewFirstName">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Last Name</div>
                                        <div class="info-value" id="viewLastName">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Username</div>
                                        <div class="info-value" id="viewUsername">-</div>
                                    </div>
                                </div>

                                <div class="info-card">
                                    <div class="info-card-title">
                                        <i class="fas fa-envelope"></i>
                                        Contact Information
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Email Address</div>
                                        <div class="info-value email" id="viewEmail">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Phone Number</div>
                                        <div class="info-value phone" id="viewPhone">-</div>
                                    </div>
                                </div>

                                <div class="info-card">
                                    <div class="info-card-title">
                                        <i class="fas fa-shield-alt"></i>
                                        Account Status
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">User Role</div>
                                        <div class="info-value" id="viewRole">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Account Status</div>
                                        <div class="info-value" id="viewAccountStatus">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Approval Status</div>
                                        <div class="info-value" id="viewApprovalStatus">-</div>
                                    </div>
                                </div>

                                <div class="info-card">
                                    <div class="info-card-title">
                                        <i class="fas fa-clock"></i>
                                        Account Timeline
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">User ID</div>
                                        <div class="info-value" id="viewUserId">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Member Since</div>
                                        <div class="info-value" id="viewMemberSince">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Last Login</div>
                                        <div class="info-value" id="viewLastLogin">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Last Updated</div>
                                        <div class="info-value" id="viewLastUpdated">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Tab -->
                    <div id="profileTab" class="tab-content">
                        <!-- Messages -->
                        <div id="profileMessage" class="message"></div>

                        <form id="profileForm">
                            <div class="form-section">
                                <h3 class="section-title">
                                    <i class="fas fa-user"></i>
                                    Personal Information
                                </h3>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="firstName">First Name *</label>
                                        <input type="text" id="firstName" name="firstName" class="form-control" required placeholder="Enter first name">
                                    </div>
                                    <div class="form-group">
                                        <label for="lastName">Last Name *</label>
                                        <input type="text" id="lastName" name="lastName" class="form-control" required placeholder="Enter last name">
                                    </div>
                                </div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="username">Username</label>
                                        <input type="text" id="username" name="username" class="form-control" placeholder="Enter username (optional)">
                                        <small>Leave empty to use email as username</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="email">Email Address *</label>
                                        <input type="email" id="email" name="email" class="form-control" required placeholder="Enter email address">
                                    </div>
                                </div>
                                <div class="form-grid single-column">
                                    <div class="form-group">
                                        <label for="phoneNumber">Phone Number</label>
                                        <input type="tel" id="phoneNumber" name="phoneNumber" class="form-control" placeholder="Enter phone number (optional)">
                                        <small>Saudi phone number format: 05xxxxxxxx or +9665xxxxxxxx</small>
                                    </div>
                                </div>
                            </div>

                            <div class="btn-group">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Save Changes
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="resetForm()">
                                    <i class="fas fa-undo"></i>
                                    Reset
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Activity Tab -->
                    <div id="activityTab" class="tab-content">
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-history"></i>
                                Recent Activity
                            </h3>
                            <div id="activityLog" class="activity-log">
                                <div class="loading-container">
                                    <div class="loading-spinner"></div>
                                    <p>Loading activity log...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Password Tab -->
                    <div id="passwordTab" class="tab-content">
                        <!-- Messages -->
                        <div id="passwordMessage" class="message"></div>

                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-key"></i>
                                Change User Password
                            </h3>
                            <div class="form-grid single-column">
                                <div class="form-group">
                                    <label for="newPassword">New Password</label>
                                    <div class="password-group">
                                        <input type="password" id="newPassword" name="newPassword" class="form-control" placeholder="Enter new password">
                                        <button type="button" class="password-toggle" onclick="togglePassword('newPassword')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <small>Password must meet security requirements below</small>
                                    <div class="password-strength" id="passwordStrength" style="display: none;">
                                        <div class="strength-meter">
                                            <div class="strength-fill" id="strengthFill"></div>
                                        </div>
                                        <div class="strength-text">
                                            <span id="strengthLabel">Password Strength</span>
                                            <span id="strengthPercent">0%</span>
                                        </div>
                                        <div class="strength-requirements">
                                            <div class="requirement" id="req-length">
                                                <i class="fas fa-times"></i>
                                                At least 8 characters
                                            </div>
                                            <div class="requirement" id="req-upper">
                                                <i class="fas fa-times"></i>
                                                One uppercase letter
                                            </div>
                                            <div class="requirement" id="req-lower">
                                                <i class="fas fa-times"></i>
                                                One lowercase letter
                                            </div>
                                            <div class="requirement" id="req-number">
                                                <i class="fas fa-times"></i>
                                                One number
                                            </div>
                                            <div class="requirement" id="req-special">
                                                <i class="fas fa-times"></i>
                                                One special character
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="btn-group">
                            <button type="button" class="btn btn-primary" onclick="changeUserPassword()">
                                <i class="fas fa-save"></i>
                                Change Password
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetPasswordForm()">
                                <i class="fas fa-undo"></i>
                                Clear Form
                            </button>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div id="settingsTab" class="tab-content">
                        <!-- Messages -->
                        <div id="settingsMessage" class="message"></div>

                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-shield-alt"></i>
                                Account Status
                            </h3>
                            <div class="form-grid single-column">
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="isAdmin" name="isAdmin">
                                        Administrator Privileges
                                    </label>
                                    <small>Grant administrative access to this user. Admins can manage users, view all reports, and access system settings.</small>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="isApproved" name="isApproved">
                                        Account Approved
                                    </label>
                                    <small>Allow user to access the system. Unapproved users cannot log in or access any features.</small>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="isActive" name="isActive">
                                        Account Active
                                    </label>
                                    <small>Enable or disable user account. Inactive users cannot log in but their data is preserved.</small>
                                </div>
                            </div>
                        </div>



                        <div class="btn-group">
                            <button type="button" class="btn btn-primary" onclick="updateUserSettings()">
                                <i class="fas fa-save"></i>
                                Update Settings
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetSettingsForm()">
                                <i class="fas fa-undo"></i>
                                Reset Form
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <!-- Confirmation Dialog -->
        <div id="confirmationDialog" class="confirmation-dialog">
            <div class="dialog-content">
                <div class="dialog-icon danger">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3 class="dialog-title">Delete User Account</h3>
                <p class="dialog-message">
                    Are you sure you want to delete this user account? This action cannot be undone and will permanently remove all user data.
                </p>
                <div class="dialog-actions">
                    <button class="btn btn-secondary" onclick="hideDeleteConfirmation()">Cancel</button>
                    <button class="btn btn-danger" onclick="deleteUser()">Delete User</button>
                </div>
            </div>
        </div>

        <!-- JavaScript -->
        <script src="/static/js/user_details.js"></script>
    </body>
</html>
